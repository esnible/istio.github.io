---
title: Migrating to the Istio Gateway
subtitle: Replace your Ingresses with Gateways using Istio 1.0
description: Converting and replacing your Kubernetes Ingresses with Istio Gateways
publishdate: 2018-08-15
attribution: Ed Snible
weight: 50
---

Before Istio 0.8 you exposed services using a Kubernetes _Ingress_.
The introduction of the _Gateway_ and _VirtualService_ allow for more
flexible configuration of exposed services.

The Istio command line _istioctl_ can convert your Ingress into a VirtualService
that you can immediately deploy.

## A sample application

You may convert your own Ingress-based application to use a Gateway and VirtualService.
I will show how to convert the Httpbin sample.  You can skip ahead to
[Deploying your Gateway](Deploying your Gateway) and use your own application instead.
 
We'll deploy the sample so that we can test it.

```
kubectl apply -f samples/httpbin/httpbin.yaml
```

Starting with Istio 1.0, the default is to automatically provide sidecars.  As long as Istio
is installed, Httpbin can be deployed in the usual way and still take advantage of Istio routing.

Let's expose the sample application using the old Ingress-based approach:

```
cat <<EOF | kubectl apply -f -
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: simple-ingress
  annotations:
    kubernetes.io/ingress.class: istio
spec:
  rules:
  - http:
      paths:
      - path: /headers
        backend:
          serviceName: httpbin
          servicePort: 8000
      - path: /delay/.*
        backend:
          serviceName: httpbin
          servicePort: 8000
EOF
```

The default for Istio 1.0 is to use only the newer IngressGateway.  This ingress will
not work unless you configured Istio to include Ingress support.  We don't need to do that
because we will immediately convert this Ingress to the new format.

## Deploying your Gateway

The `istioctl` CLI includes a command to convert an Ingress.  Let's perform the conversion.
Replace _simple-ingress_ with the name of your Ingress.

```
kubectl get ingress simple-ingress -o yaml > ingress.yaml
istioctl experimental convert-ingress -f ingress.yaml > vservice.yaml
```

You have now created the deployment descriptor for an Istio Virtual Service.
Inspect the generated _vservice.yaml_.

The generated Virtual Service depends on an Istio Gateway.  If you already have a Gateway
you can set the `gateways:` entry to refer to it.  If not, create a wildcard Gateway:

```
cat <<EOF | kubectl apply -f -
apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: istio-autogenerated-k8s-ingress
  namespace: istio-system
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*"
EOF
```
 
The Virtual Service now has a Gateway and may be deployed.

``` 
kubectl apply -f vservice.yaml
```

## Testing your Gateway

The Httpbin server returns the HTTP headers when the /headers endpoint is invoked.
 
```
export INGRESS_HOST=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
curl -v http://$INGRESS_HOST:31380/headers
```

